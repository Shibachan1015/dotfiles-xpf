# ~/.zshrc - Managed by chezmoi
# OS: {{ .osid }}

# ============= Powerlevel10k Instant Prompt =============
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# ============= Oh-My-Zsh =============
export ZSH="$HOME/.oh-my-zsh"
ZSH_THEME="powerlevel10k/powerlevel10k"
plugins=(git zsh-autosuggestions zsh-syntax-highlighting)
source $ZSH/oh-my-zsh.sh

# ============= 共通設定 =============
export EDITOR=nvim
export VISUAL=nvim

# エイリアス
alias vim="nvim"
alias g="git"
alias lg="lazygit"
alias ll="ls -l"
alias la="ls -la"

# Claude Code
alias cc="claude"
alias ccc="claude --continue"
alias ccd="claude --dangerously-skip-permissions"
alias ccdc="claude --dangerously-skip-permissions --continue"
alias ccup="curl -fsSL https://claude.ai/install.sh | bash"

# ============= OS固有設定 =============
{{ if .is_wsl -}}
# ----- WSL固有 -----

# SSH keychain (WSL2でSSHエージェントを永続化)
if command -v keychain &> /dev/null; then
  eval $(keychain --eval --quiet --nogui ~/.ssh/{{ .ssh_key }})
fi

# X11転送 (GUIアプリ用)
export DISPLAY=$(awk '/nameserver / {print $2; exit}' /etc/resolv.conf 2>/dev/null):0
export LIBGL_ALWAYS_INDIRECT=1

# WSL用ブラウザ
export BROWSER=wslview

{{ else if .is_darwin -}}
# ----- macOS固有 -----

# Homebrew
eval "$(/opt/homebrew/bin/brew shellenv)"

# 1Password SSH Agent (macOS)
export SSH_AUTH_SOCK=~/Library/Group\ Containers/2BUA8C4S2C.com.1password/t/agent.sock

{{ end -}}

# ============= 開発環境 =============
# Nix
if [ -e ~/.nix-profile/etc/profile.d/nix.sh ]; then
  . ~/.nix-profile/etc/profile.d/nix.sh
fi

# NVM (Node Version Manager)
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

# Go
export GOPATH="$HOME/go"
export PATH="$GOPATH/bin:$PATH"

# Rust/Cargo
[ -f "$HOME/.cargo/env" ] && . "$HOME/.cargo/env"

# ローカルbin
export PATH="$HOME/.local/bin:$PATH"

# ============= Powerlevel10k =============
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh
